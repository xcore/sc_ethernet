
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>API &mdash; Ethernet Component v1v4 documentation</title>
    <link rel="stylesheet" href="_static/xdoc.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '1v4',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="Ethernet Component v1v4 documentation" href="index.html" />
    <link rel="prev" title="A Sample Ethernet Application (tutorial)" href="app_tutorial.html" /> 

<script>
function setheight() {
h1 = document.getElementById('d1').style.height;
h2 = document.getElementById('d2').style.height;

if (parseInt(h1) > parseInt(h2)) {
document.getElementById('d2').style.height=h1 + "px";
}
else {
document.getElementById('d1').style.height=h2 + "px";
}

}
</script>
</head>

<body onload="setheight();">

  

    <div class="document" id='d1'>
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
<div style="float: right">
<a href="app_tutorial.html"
                        title="previous chapter"> &lt&lt </a>
</div>

            
  <div class="section" id="api">
<span id="sec-api"></span><h1>API<a class="headerlink" href="#api" title="Permalink to this headline">¶</a></h1>
<div class="section" id="configuration-defines">
<span id="sec-conf-defines"></span><h2>Configuration Defines<a class="headerlink" href="#configuration-defines" title="Permalink to this headline">¶</a></h2>
<p>The file ethernet_conf.h must be provided in the application source
code. This file can set the following defines:</p>
<p><strong>MAX_ETHERNET_PACKET_SIZE</strong></p>
<blockquote>
<div>This define sets the largest packet size in bytes that the ethernet mac
will receive. The default it the largest possible ethernet packet
size (1518 bytes). Setting this to a smaller value will save
memory but restrict the type of packets you can receieve.</div></blockquote>
<p><strong>NUM_MII_RX_BUF</strong></p>
<blockquote>
<div>Number of incoming packets that will be buffered within the MAC.</div></blockquote>
<p><strong>NUM_MII_TX_BUF</strong></p>
<blockquote>
<div>Number of outgoing packets that will be buffered within the MAC.</div></blockquote>
<p><strong>MAX_ETHERNET_CLIENTS</strong></p>
<blockquote>
<div>The maximum number of clients that can be connected to the
<a class="reference internal" href="#ethernet_server" title="ethernet_server"><tt class="xref c c-func docutils literal"><span class="pre">ethernet_server()</span></tt></a> function via the rx and tx channel arrays.</div></blockquote>
</div>
<div class="section" id="custom-filter-function">
<h2>Custom Filter Function<a class="headerlink" href="#custom-filter-function" title="Permalink to this headline">¶</a></h2>
<p>Every application is required to provide this function. It also needs
to be prototyped (or defined as an inline definition) in the header
file <tt class="docutils literal"><span class="pre">mac_custom_filter.h</span></tt>.</p>
<dl class="function">
<dt id="mac_custom_filter">
int <tt class="descname">mac_custom_filter</tt><big>(</big>unsigned int<em>&nbsp;data[]</em><big>)</big><a class="headerlink" href="#mac_custom_filter" title="Permalink to this definition">¶</a></dt>
<dd><p>This function examines an ethernet packet and returns a filter
number to allow different clients to obtain different types of packet.
The function <em>must</em> run within 6us to allow 100Mbit filtering of
packets.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>data</strong> &#8211; This array contains the ethernet packet. It does not
include the preamble but does include the layer 2
header or the packet.</li>
</ul>
</td>
</tr>
<tr class="field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">0 if the packet is not wanted by the application or
a number that can be registed by
<a class="reference internal" href="#mac_set_custom_filter" title="mac_set_custom_filter"><tt class="xref c c-func docutils literal"><span class="pre">mac_set_custom_filter()</span></tt></a> by a client. Clients
register a mask so the number is usually made up of a
bit per unique client destination for the packet.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
<div class="section" id="data-structures">
<h2>Data Structures<a class="headerlink" href="#data-structures" title="Permalink to this headline">¶</a></h2>
<dt><dl class="type">
<dt id="mii_interface_t">
<tt class="descname">mii_interface_t</tt><a class="headerlink" href="#mii_interface_t" title="Permalink to this definition">¶</a></dt>
<dd><p>Structure containing resources required for the MII ethernet interface.</p>
<p>This structure contains resources required to make up an MII interface. It consists of 7 ports and 2 clock blocks.</p>
<p>The clock blocks can be any available clock blocks and will be clocked of incoming rx/tx clock pins.</p>
<p><strong>See also:</strong></p>
<p><a class="reference internal" href="#ethernet_server" title="ethernet_server"><tt class="xref c c-func docutils literal"><span class="pre">ethernet_server()</span></tt></a></p>
<p><strong>Structure Members</strong>:</p>
<dl class="member">
<dt id="mii_interface_t.clk_mii_rx">
clock <tt class="descname">clk_mii_rx</tt><a class="headerlink" href="#mii_interface_t.clk_mii_rx" title="Permalink to this definition">¶</a></dt>
<dd><p>MII RX Clock Block.</p>
</dd></dl>

<dl class="member">
<dt id="mii_interface_t.clk_mii_tx">
clock <tt class="descname">clk_mii_tx</tt><a class="headerlink" href="#mii_interface_t.clk_mii_tx" title="Permalink to this definition">¶</a></dt>
<dd><p>MII TX Clock Block.</p>
</dd></dl>

<dl class="member">
<dt id="mii_interface_t.p_mii_rxclk">
in port <tt class="descname">p_mii_rxclk</tt><a class="headerlink" href="#mii_interface_t.p_mii_rxclk" title="Permalink to this definition">¶</a></dt>
<dd><p>MII RX clock wire.</p>
</dd></dl>

<dl class="member">
<dt id="mii_interface_t.p_mii_rxer">
in port <tt class="descname">p_mii_rxer</tt><a class="headerlink" href="#mii_interface_t.p_mii_rxer" title="Permalink to this definition">¶</a></dt>
<dd><p>MII RX error wire.</p>
</dd></dl>

<dl class="member">
<dt id="mii_interface_t.p_mii_rxd">
in buffered port:32 <tt class="descname">p_mii_rxd</tt><a class="headerlink" href="#mii_interface_t.p_mii_rxd" title="Permalink to this definition">¶</a></dt>
<dd><p>MII RX data wire.</p>
</dd></dl>

<dl class="member">
<dt id="mii_interface_t.p_mii_rxdv">
in port <tt class="descname">p_mii_rxdv</tt><a class="headerlink" href="#mii_interface_t.p_mii_rxdv" title="Permalink to this definition">¶</a></dt>
<dd><p>MII RX data valid wire.</p>
</dd></dl>

<dl class="member">
<dt id="mii_interface_t.p_mii_txclk">
in port <tt class="descname">p_mii_txclk</tt><a class="headerlink" href="#mii_interface_t.p_mii_txclk" title="Permalink to this definition">¶</a></dt>
<dd><p>MII TX clock wire.</p>
</dd></dl>

<dl class="member">
<dt id="mii_interface_t.p_mii_txen">
out port <tt class="descname">p_mii_txen</tt><a class="headerlink" href="#mii_interface_t.p_mii_txen" title="Permalink to this definition">¶</a></dt>
<dd><p>MII TX enable wire.</p>
</dd></dl>

<dl class="member">
<dt id="mii_interface_t.p_mii_txd">
out buffered port:32 <tt class="descname">p_mii_txd</tt><a class="headerlink" href="#mii_interface_t.p_mii_txd" title="Permalink to this definition">¶</a></dt>
<dd><p>MII TX data wire.</p>
</dd></dl>

</dd></dl>

<dt><dl class="type">
<dt id="smi_interface_t">
<tt class="descname">smi_interface_t</tt><a class="headerlink" href="#smi_interface_t" title="Permalink to this definition">¶</a></dt>
<dd><p>Structure containing resources required for the SMI ethernet phy interface.</p>
<p>This structure contains the resources required to communicate with an ethernet phy over smi.</p>
<p><strong>Structure Members</strong>:</p>
<dl class="member">
<dt id="smi_interface_t.p_smi_mdio">
port <tt class="descname">p_smi_mdio</tt><a class="headerlink" href="#smi_interface_t.p_smi_mdio" title="Permalink to this definition">¶</a></dt>
<dd><p>MDIO port.</p>
</dd></dl>

<dl class="member">
<dt id="smi_interface_t.p_smi_mdc">
out port <tt class="descname">p_smi_mdc</tt><a class="headerlink" href="#smi_interface_t.p_smi_mdc" title="Permalink to this definition">¶</a></dt>
<dd><p>MDC port.</p>
</dd></dl>

<dl class="member">
<dt id="smi_interface_t.mdio_mux">
int <tt class="descname">mdio_mux</tt><a class="headerlink" href="#smi_interface_t.mdio_mux" title="Permalink to this definition">¶</a></dt>
<dd><p>This flag needs to be set if the MDIO port is shared with the phy reset line.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="otp-mac-address-reading">
<h2>OTP MAC Address Reading<a class="headerlink" href="#otp-mac-address-reading" title="Permalink to this headline">¶</a></h2>
<dt><dl class="function">
<dt id="ethernet_getmac_otp">
void <tt class="descname">ethernet_getmac_otp</tt><big>(</big>port<em>&nbsp;otp_data</em>, out port<em>&nbsp;otp_addr</em>, port<em>&nbsp;otp_ctrl</em>, char<em>&nbsp;macaddr[]</em><big>)</big><a class="headerlink" href="#ethernet_getmac_otp" title="Permalink to this definition">¶</a></dt>
<dd><p>Retrieves least significant 24bits from MAC address stored in OTP.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>otp_data</strong> &#8211; Data port connected to otp</li>
<li><strong>otp_addr</strong> &#8211; Address port connected to otp</li>
<li><strong>otp_ctrl</strong> &#8211; Control port connected to otp</li>
<li><strong>macaddr</strong> &#8211; Array to be filled with the retrieved MAC address</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
<div class="section" id="ethernet-phy-api">
<h2>Ethernet Phy API<a class="headerlink" href="#ethernet-phy-api" title="Permalink to this headline">¶</a></h2>
<dt><dl class="function">
<dt id="phy_init">
void <tt class="descname">phy_init</tt><big>(</big>clock<em>&nbsp;clk_smi</em>, out port<em>&nbsp;?p_mii_resetn</em>, <a class="reference internal" href="#smi_interface_t" title="smi_interface_t">smi_interface_t</a><em>&nbsp;&amp;smi0</em>, <a class="reference internal" href="#mii_interface_t" title="mii_interface_t">mii_interface_t</a><em>&nbsp;&amp;mii0</em><big>)</big><a class="headerlink" href="#phy_init" title="Permalink to this definition">¶</a></dt>
<dd><p>Reset and initialize the ethernet phy.</p>
<p>This function resets the ethernet phy and initializes the MII resources. It should be called before calling <a class="reference internal" href="#ethernet_server" title="ethernet_server"><tt class="xref c c-func docutils literal"><span class="pre">ethernet_server()</span></tt></a>. This function is designed to work with SMSC phys models: ...</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>clk_smi</strong> &#8211; The clock block used for smi clocking</li>
<li><strong>p_mii_resetn</strong> &#8211; This port connected to the phy reset line. This parameter can be null if the reset line is multiplexed on the SMI MDIO port.</li>
<li><strong>smi0</strong> &#8211; The SMI resources to connect to the phy</li>
<li><strong>mii0</strong> &#8211; The MII resources to connect to the phy</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
<div class="section" id="mac-server-api">
<h2>MAC Server API<a class="headerlink" href="#mac-server-api" title="Permalink to this headline">¶</a></h2>
<dt><dl class="function">
<dt id="ethernet_server">
void <tt class="descname">ethernet_server</tt><big>(</big><a class="reference internal" href="#mii_interface_t" title="mii_interface_t">mii_interface_t</a><em>&nbsp;&amp;mii</em>, int<em>&nbsp;mac_address[]</em>, chanend<em>&nbsp;rx[]</em>, int<em>&nbsp;num_rx</em>, chanend<em>&nbsp;tx[]</em>, int<em>&nbsp;num_tx</em>, <a class="reference internal" href="#smi_interface_t" title="smi_interface_t">smi_interface_t</a> &amp;<em>&nbsp;?smi</em>, chanend<em>&nbsp;?connect_status</em><big>)</big><a class="headerlink" href="#ethernet_server" title="Permalink to this definition">¶</a></dt>
<dd><p>Single MII port MAC/ethernet server.</p>
<p>This function provides both MII layer and MAC layer functionality. It runs in 5 threads and communicates to clients over the channel array parameters.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>mii</strong> &#8211; The mii interface resources that the server will connect to</li>
<li><strong>mac_address</strong> &#8211; The mac_address the server will use. This should be a two-word array that stores the 6-byte macaddr in a little endian manner (so reinterpreting the array as a char array is as one would expect)</li>
<li><strong>rx</strong> &#8211; An array of chanends to connect to clients of the server who wish to receive packets.</li>
<li><strong>num_rx</strong> &#8211; The number of clients connected to the rx array</li>
<li><strong>tx</strong> &#8211; An array of chanends to connect to clients of the server who wish to transmit packets.</li>
<li><strong>num_tx</strong> &#8211; The number of clients connected to the txx array</li>
<li><strong>smi</strong> &#8211; An optional parameter of resources to connect to a PHY (via SMI) to check when the link is up.</li>
<li><strong>connect_status</strong> &#8211; An optional parameter of a channel that is signalled when the link goes up or down (requires the smi parameter to be supplied).</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>The clients connected via the rx/tx channels can communicate with the server using the APIs found in ethernet_rx_client.h and ethernet_tx_client.h</p>
<p>If the smi and connect_status parameters are supplied then the connect_status channel will output when the link goes up or down. The channel will output a zero byte, followed by the status (1 for up, 0 for down), followed by a zero byte, followed by an END control token.,</p>
<p>The following code snippet is an example of how to receive this update:</p>
<blockquote>
<div><div class="highlight-none"><div class="highlight"><pre>(void) inuchar(connect_status);
new_status = inuchar(c);
(void) inuchar(c, 0);
(void) inct(c);
</pre></div>
</div>
</div></blockquote>
</dd></dl>

</div>
<div class="section" id="rx-client-api">
<h2>RX Client API<a class="headerlink" href="#rx-client-api" title="Permalink to this headline">¶</a></h2>
<div class="section" id="packet-receive-functions">
<h3>Packet Receive Functions<a class="headerlink" href="#packet-receive-functions" title="Permalink to this headline">¶</a></h3>
<dt><dl class="function">
<dt id="mac_rx">
void <tt class="descname">mac_rx</tt><big>(</big>chanend<em>&nbsp;c_mac</em>, unsigned char<em>&nbsp;buffer[]</em>, unsigned int<em>&nbsp;&amp;len</em>, unsigned int<em>&nbsp;&amp;src_port</em><big>)</big><a class="headerlink" href="#mac_rx" title="Permalink to this definition">¶</a></dt>
<dd><p>This function receives a complete frame (i.e.</p>
<p>src/dest MAC address, type &amp; payload), excluding pre-amble, SoF &amp; CRC32 from the ethernet server.</p>
<p>This function is selectable i.e. it can be used as a case in a select e.g.</p>
<blockquote>
<div><div class="highlight-none"><div class="highlight"><pre>select {
   ...
   case mac_rx(...):
      break;
    ...
  }
</pre></div>
</div>
</div></blockquote>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>c_mac</strong> &#8211; A chanend connected to the ethernet server</li>
<li><strong>buffer</strong> &#8211; The buffer to fill with the incoming packet</li>
<li><strong>src_port</strong> &#8211; A reference parameter to be filled with the ethernet port the packet came from.</li>
<li><strong>len</strong> &#8211; A reference parameter to be filled with the length of the received packet in bytes.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dt><dl class="function">
<dt id="mac_rx_timed">
void <tt class="descname">mac_rx_timed</tt><big>(</big>chanend<em>&nbsp;c_mac</em>, unsigned char<em>&nbsp;buffer[]</em>, unsigned int<em>&nbsp;&amp;len</em>, unsigned int<em>&nbsp;&amp;time</em>, unsigned int<em>&nbsp;&amp;src_port</em><big>)</big><a class="headerlink" href="#mac_rx_timed" title="Permalink to this definition">¶</a></dt>
<dd><p>This function receives a complete frame (i.e.</p>
<p>src/dest MAC address, type &amp; payload), excluding pre-amble, SoF &amp; CRC32. It also timestamps the arrival of the frame.</p>
<p>This function is selectable.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>c_mac</strong> &#8211; A chanend connected to the ethernet server</li>
<li><strong>buffer</strong> &#8211; The buffer to fill with the incoming packet</li>
<li><strong>time</strong> &#8211; A reference parameter to be filled with the timestamp of the packet</li>
<li><strong>len</strong> &#8211; A reference parameter to be filled with the length of the received packet in bytes.</li>
<li><strong>src_port</strong> &#8211; A reference parameter to be filled with the ethernet port the packet came from.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dt><dl class="function">
<dt id="safe_mac_rx">
void <tt class="descname">safe_mac_rx</tt><big>(</big>chanend<em>&nbsp;c_mac</em>, unsigned char<em>&nbsp;buffer[]</em>, unsigned int<em>&nbsp;&amp;len</em>, unsigned int<em>&nbsp;&amp;src_port</em>, int<em>&nbsp;n</em><big>)</big><a class="headerlink" href="#safe_mac_rx" title="Permalink to this definition">¶</a></dt>
<dd><p>This function receives a complete frame (i.e.</p>
<p>src/dest MAC address, type &amp; payload), excluding pre-amble, SoF &amp; CRC32 from the ethernet server. In addition it will only fill the given buffer up to a specified length.</p>
<p>This function is selectable i.e. it can be used as a case in a select.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>c_mac</strong> &#8211; A chanend connected to the ethernet server</li>
<li><strong>buffer</strong> &#8211; The buffer to fill with the incoming packet</li>
<li><strong>src_port</strong> &#8211; A reference parameter to be filled with the ethernet port the packet came from.</li>
<li><strong>len</strong> &#8211; A reference parameter to be filled with the length of the received packet in bytes.</li>
<li><strong>n</strong> &#8211; The maximum number of bytes to fill the supplied buffer with.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dt><dl class="function">
<dt id="safe_mac_rx_timed">
void <tt class="descname">safe_mac_rx_timed</tt><big>(</big>chanend<em>&nbsp;c_mac</em>, unsigned char<em>&nbsp;buffer[]</em>, unsigned int<em>&nbsp;&amp;len</em>, unsigned int<em>&nbsp;&amp;time</em>, unsigned int<em>&nbsp;&amp;src_port</em>, int<em>&nbsp;n</em><big>)</big><a class="headerlink" href="#safe_mac_rx_timed" title="Permalink to this definition">¶</a></dt>
<dd><p>This function receives a complete frame (i.e.</p>
<p>src/dest MAC address, type &amp; payload), excluding pre-amble, SoF &amp; CRC32. It also timestamp the arrival of the frame. In addition it will only fill the given buffer up to a specified length.</p>
<p>This function is selectable.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>c_mac</strong> &#8211; A chanend connected to the ethernet server</li>
<li><strong>buffer</strong> &#8211; The buffer to fill with the incoming packet</li>
<li><strong>time</strong> &#8211; A reference parameter to be filled with the timestamp of the packet</li>
<li><strong>len</strong> &#8211; A reference parameter to be filled with the length of the received packet in bytes.</li>
<li><strong>src_port</strong> &#8211; A reference parameter to be filled with the ethernet port the packet came from.</li>
<li><strong>n</strong> &#8211; The maximum number of bytes to fill the supplied buffer with.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
<div class="section" id="configuration-functions">
<h3>Configuration Functions<a class="headerlink" href="#configuration-functions" title="Permalink to this headline">¶</a></h3>
<dt><dl class="function">
<dt id="mac_set_drop_packets">
void <tt class="descname">mac_set_drop_packets</tt><big>(</big>chanend<em>&nbsp;c_mac_svr</em>, int<em>&nbsp;x</em><big>)</big><a class="headerlink" href="#mac_set_drop_packets" title="Permalink to this definition">¶</a></dt>
<dd><p>Setup whether a link should drop packets or block if the link is not ready.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>c_mac_svr</strong> &#8211; chanend of receive server.</li>
<li><strong>x</strong> &#8211; boolean value as to whether packets should be dropped at mac layer.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>NOTE: setting no dropped packets does not mean no packets will be dropped. If packets are not dropped at the mac layer, it will block the mii fifo. The Mii fifo could possibly overflow and frames for other links could be dropped.</p>
</dd></dl>

<dt><dl class="function">
<dt id="mac_set_queue_size">
void <tt class="descname">mac_set_queue_size</tt><big>(</big>chanend<em>&nbsp;c_mac_svr</em>, int<em>&nbsp;x</em><big>)</big><a class="headerlink" href="#mac_set_queue_size" title="Permalink to this definition">¶</a></dt>
<dd><p>Setup the size of the buffer queue within the mac attached to this link.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>c_mac_svr</strong> &#8211; chanend connected to the mac</li>
<li><strong>x</strong> &#8211; the required size of the queue</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dt><dl class="function">
<dt id="mac_set_custom_filter">
void <tt class="descname">mac_set_custom_filter</tt><big>(</big>chanend<em>&nbsp;c_mac_svr</em>, int<em>&nbsp;x</em><big>)</big><a class="headerlink" href="#mac_set_custom_filter" title="Permalink to this definition">¶</a></dt>
<dd><p>Setup the custom filter up on a link.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>c_mac_svr</strong> &#8211; chanend of receive server.</li>
<li><strong>x</strong> &#8211; filter value</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>For each packet, the filter value is &amp;-ed against the result of the mac_custom_filter function. If the result is non-zero then the packet is transmitted down the link.</p>
</dd></dl>

</div>
</div>
<div class="section" id="tx-client-api">
<h2>TX Client API<a class="headerlink" href="#tx-client-api" title="Permalink to this headline">¶</a></h2>
<div class="section" id="packet-transmit-functions">
<h3>Packet Transmit Functions<a class="headerlink" href="#packet-transmit-functions" title="Permalink to this headline">¶</a></h3>
<dt><dl class="function">
<dt id="mac_tx">
void <tt class="descname">mac_tx</tt><big>(</big>chanend<em>&nbsp;c_mac</em>, unsigned int<em>&nbsp;buffer[]</em>, int<em>&nbsp;nbytes</em>, int<em>&nbsp;ifnum</em><big>)</big><a class="headerlink" href="#mac_tx" title="Permalink to this definition">¶</a></dt>
<dd><p>Sends an ethernet frame.</p>
<p>Frame includes dest/src MAC address(s), type and payload.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>c_mac</strong> &#8211; channel end to tx server.</li>
<li><strong>buffer[]</strong> &#8211; byte array containing the ethernet frame. <em>This must be word aligned</em></li>
<li><strong>nbytes</strong> &#8211; number of bytes in buffer</li>
<li><strong>ifnum</strong> &#8211; the number of the eth interface to transmit to (use ETH_BROADCAST transmits to all ports)</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dt><dl class="function">
<dt id="mac_tx_timed">
void <tt class="descname">mac_tx_timed</tt><big>(</big>chanend<em>&nbsp;c_mac</em>, unsigned int<em>&nbsp;buffer[]</em>, int<em>&nbsp;nbytes</em>, unsigned int<em>&nbsp;&amp;time</em>, int<em>&nbsp;ifnum</em><big>)</big><a class="headerlink" href="#mac_tx_timed" title="Permalink to this definition">¶</a></dt>
<dd><p>Sends an ethernet frame and gets the timestamp of the send.</p>
<p>Frame includes dest/src MAC address(s), type and payload.</p>
<p>This is a blocking call and returns the <em>actual time</em> the frame is sent to PHY according to the XCore 100Mhz 32-bit timer on the core the ethernet server is running.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>c_mac</strong> &#8211; channel end connected to ethernet server.</li>
<li><strong>buffer[]</strong> &#8211; byte array containing the ethernet frame. <em>This must be word aligned</em></li>
<li><strong>nbytes</strong> &#8211; number of bytes in buffer</li>
<li><strong>ifnum</strong> &#8211; the number of the eth interface to transmit to (use ETH_BROADCAST transmits to all ports)</li>
<li><strong>time</strong> &#8211; A reference paramater that is set to the time the packet is sent to the phy</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>NOTE: This function will block until the packet is sent to PHY.</p>
</dd></dl>

</div>
<div class="section" id="id1">
<h3>Configuration Functions<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<dt><dl class="function">
<dt id="mac_get_macaddr">
int <tt class="descname">mac_get_macaddr</tt><big>(</big>chanend<em>&nbsp;c_mac</em>, unsigned char<em>&nbsp;macaddr[]</em><big>)</big><a class="headerlink" href="#mac_get_macaddr" title="Permalink to this definition">¶</a></dt>
<dd><p>Get the device MAC address.</p>
<p>This function gets the MAC address of the device (the address passed into the <a class="reference internal" href="#ethernet_server" title="ethernet_server"><tt class="xref c c-func docutils literal"><span class="pre">ethernet_server()</span></tt></a> function.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>c_mac</strong> &#8211; chanend end connected to ethernet server</li>
<li><strong>macaddr[]</strong> &#8211; an array of type char where the MAC address is placed (in network order).</li>
</ul>
</td>
</tr>
<tr class="field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">zero on success and non-zero on failure.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
</div>
</div>



          </div>
        </div>
      </div>
      <div class="sphinxsidebar" id='d2'>
        <div class="sphinxsidebarwrapper">
<h3><a href="index.html">Table Of Contents</a></h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="hw.html">H/W Development Platforms</a></li>
<li class="toctree-l1"><a class="reference internal" href="system.html">Ethernet Mac Description</a></li>
<li class="toctree-l1"><a class="reference internal" href="programming.html">Programming Guide</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="">API</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#configuration-defines">Configuration Defines</a></li>
<li class="toctree-l2"><a class="reference internal" href="#custom-filter-function">Custom Filter Function</a></li>
<li class="toctree-l2"><a class="reference internal" href="#data-structures">Data Structures</a></li>
<li class="toctree-l2"><a class="reference internal" href="#otp-mac-address-reading">OTP MAC Address Reading</a></li>
<li class="toctree-l2"><a class="reference internal" href="#ethernet-phy-api">Ethernet Phy API</a></li>
<li class="toctree-l2"><a class="reference internal" href="#mac-server-api">MAC Server API</a></li>
<li class="toctree-l2"><a class="reference internal" href="#rx-client-api">RX Client API</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#packet-receive-functions">Packet Receive Functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#configuration-functions">Configuration Functions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#tx-client-api">TX Client API</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#packet-transmit-functions">Packet Transmit Functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id1">Configuration Functions</a></li>
</ul>
</li>
</ul>
</li>
</ul>

<div id="searchbox" style="display: none">
  <h3>Search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" size="18" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>



    <div class="footer">
    </div>
  </body>
</html>



